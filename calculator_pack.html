<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finance Tools & Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Free finance calculators, retirement tools, Snake game, Tetris game, and stock market open countdowns.">
<style>
body {
    margin:0;
    font-family:Arial, sans-serif;
    background:#f4f4f4;
    display:flex;
    justify-content:center;
}
.container {
    display:flex;
    max-width:1200px;
    width:100%;
    padding:20px;
    gap:20px;
}
.left {
    flex:1;
    min-width:320px;
}
.right {
    width:400px;
    display:flex;
    flex-direction:column;
    gap:20px;
}
.card {
    background:white;
    padding:15px;
    border-radius:8px;
    box-shadow:0 2px 8px rgba(0,0,0,.1);
}
label { display:block; margin-top:8px; }
input {
    width:100%;
    padding:6px;
    margin-top:3px;
    box-sizing:border-box;
}
.result {
    margin-top:10px;
    font-weight:bold;
}
canvas {
    background:#111;
    border-radius:10px;
    display:block;
}
.game-box {
    position:relative;
    cursor:pointer;
}
.overlay {
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:22px;
    background:rgba(0,0,0,.6);
    display:none;
}
.score {
    position:absolute;
    top:6px;
    left:8px;
    color:white;
    font-weight:bold;
}
.countdown {
    font-size:18px;
    margin-top:5px;
}
</style>
</head>
<body>

<div class="container">

<div class="left">

<div class="card">
<b>Retirement Withdrawal Calculator</b>
<label>Current Savings (â‚¬)<input id="ret_cur" type="number"></label>
<label>Monthly Contribution (â‚¬)<input id="ret_month" type="number"></label>
<label>Annual Return (%)<input id="ret_rate" type="number"></label>
<label>Years to Save<input id="ret_years" type="number"></label>
<label>Monthly Withdrawal in Retirement (â‚¬)<input id="ret_with" type="number"></label>
<div class="result" id="ret_out"></div>
</div>

<div class="card">
<b>Market Opens In</b>
<div>ðŸ‡«ðŸ‡® Helsinki Stock Exchange<div class="countdown" id="hel"></div></div>
<div>ðŸ‡ºðŸ‡¸ New York Stock Exchange<div class="countdown" id="ny"></div></div>
</div>

</div>

<div class="right">

<div class="game-box" id="snakeBox">
<canvas id="snake" width="400" height="400"></canvas>
<div class="score" id="snakeScore">Coins: 0</div>
<div class="overlay" id="snakeOver">GAME OVER<br>Click to restart</div>
</div>

<div class="game-box" id="tetrisBox">
<canvas id="tetris" width="400" height="400"></canvas>
<div class="score" id="tetrisScore">Score: 0</div>
</div>

</div>
</div>

<script>
// ================= RETIREMENT =================
function updateRet(){
    let c=+ret_cur.value||0, m=+ret_month.value||0, r=+ret_rate.value/100, y=+ret_years.value, w=+ret_with.value||0;
    if(!r){ret_out.innerHTML="Enter return rate"; return;}
    if(!w && y){
        let months=y*12, cap=c;
        for(let i=0;i<months;i++) cap=cap*(1+r/12)+m;
        w=(cap*r)/12;
        ret_with.value=w.toFixed(2);
    }
    if(!y && w){
        let cap=c, months=0;
        while((cap*r)/12<w && months<1000*12){
            cap=cap*(1+r/12)+m;
            months++;
        }
        ret_years.value=(months/12).toFixed(1);
    }
    ret_out.innerHTML=`Capital at retirement â‰ˆ â‚¬${(c+m*(y||0)*12).toFixed(0)}<br>Safe monthly withdrawal â‰ˆ â‚¬${w.toFixed(2)}`;
}
["ret_cur","ret_month","ret_rate","ret_years","ret_with"].forEach(id=>window[id].addEventListener("input",updateRet));

// ================= MARKET COUNTDOWN =================
function nextOpen(hour, min, offset){
    let now=new Date(), utc=now.getTime()+now.getTimezoneOffset()*60000;
    let local=new Date(utc+offset*3600000);
    let open=new Date(local);
    open.setHours(hour,min,0,0);
    if(local.getDay()==6) open.setDate(open.getDate()+2);
    if(local.getDay()==0) open.setDate(open.getDate()+1);
    if(local>=open) open.setDate(open.getDate()+1);
    return open-local;
}
function tick(){
    let h=nextOpen(10,0,2); // Helsinki 10:00 EET
    let n=nextOpen(9,30,-5); // NYSE 9:30 ET
    hel.innerHTML=new Date(h).toISOString().substr(11,8);
    ny.innerHTML=new Date(n).toISOString().substr(11,8);
}
setInterval(tick,1000); tick();

// ================= SNAKE =================
const sc=snake.getContext("2d"), S=20, R=20;
let s=[], dir, coin, alive=false, coins=0, snakeActive=false;

function startSnake(){
    s=[{x:200,y:200}]; dir={x:S,y:0};
    coin={x:Math.floor(Math.random()*R)*S,y:Math.floor(Math.random()*R)*S};
    coins=0; snakeScore.innerText="Coins: 0";
    snakeOver.style.display="none";
    alive=true; snakeActive=true;
}
function drawSnake(){
    sc.fillStyle="#111"; sc.fillRect(0,0,400,400);
    sc.fillStyle="gold"; sc.beginPath();
    sc.arc(coin.x+10,coin.y+10,8,0,Math.PI*2); sc.fill();
    sc.fillStyle="#00ff99";
    s.forEach(p=>sc.fillRect(p.x+2,p.y+2,16,16));
}
function loopSnake(){
    if(!alive||!snakeActive) return;
    let h={x:s[0].x+dir.x,y:s[0].y+dir.y};
    if(h.x<0||h.y<0||h.x>=400||h.y>=400) return endSnake();
    if(s.some(p=>p.x==h.x&&p.y==h.y)) return endSnake();
    s.unshift(h);
    if(h.x==coin.x&&h.y==coin.y){
        coins++; snakeScore.innerText="Coins: "+coins;
        coin={x:Math.floor(Math.random()*R)*S,y:Math.floor(Math.random()*R)*S};
    } else s.pop();
    drawSnake();
}
function endSnake(){alive=false; snakeOver.style.display="flex";}
setInterval(loopSnake,150);
snakeBox.onclick=()=>startSnake();
document.addEventListener("keydown",e=>{
    if(!snakeActive) return;
    if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();
    if(e.key=="ArrowUp"&&dir.y==0)dir={x:0,y:-S};
    if(e.key=="ArrowDown"&&dir.y==0)dir={x:0,y:S};
    if(e.key=="ArrowLeft"&&dir.x==0)dir={x:-S,y:0};
    if(e.key=="ArrowRight"&&dir.x==0)dir={x:S,y:0};
});
document.addEventListener("click",e=>{snakeActive=snakeBox.contains(e.target);});

// ================= TETRIS (FIXED SPEED) =================
const tc=tetris.getContext("2d"), COL=10, ROW=20, TS=20;
let grid=Array.from({length:ROW},()=>Array(COL).fill(0));
let piece=null, tActive=false, score=0;
const shapes=[[[1,1,1,1]],[[1,1],[1,1]],[[0,1,0],[1,1,1]]];

function newPiece(){
    let s=shapes[Math.floor(Math.random()*shapes.length)];
    piece={x:4,y:0,s:s};
}
function drawTetris(){
    tc.fillStyle="#111"; tc.fillRect(0,0,400,400);
    tc.fillStyle="cyan";
    grid.forEach((r,y)=>r.forEach((c,x)=>{if(c)tc.fillRect(x*TS,y*TS,TS,TS);}));
    if(piece) piece.s.forEach((r,y)=>r.forEach((c,x)=>{if(c)tc.fillRect((piece.x+x)*TS,(piece.y+y)*TS,TS,TS);}));
}
function collide(px,py,ps){
    return ps.some((r,y)=>r.some((c,x)=>{
        let nx=px+x, ny=py+y;
        return c&&(nx<0||nx>=COL||ny>=ROW||grid[ny][nx]);
    }));
}
function drop(){
    if(!tActive||!piece) return;
    piece.y++;
    if(collide(piece.x,piece.y,piece.s)){
        piece.y--;
        piece.s.forEach((r,y)=>r.forEach((c,x)=>{if(c)grid[piece.y+y][piece.x+x]=1;}));
        newPiece();
    }
    drawTetris();
}
setInterval(drop,900); // <<< FIXED SPEED
tetrisBox.onclick=()=>{tActive=true; if(!piece)newPiece();};
document.addEventListener("click",e=>{if(!tetrisBox.contains(e.target))tActive=false;});
</script>
</body>
</html>
